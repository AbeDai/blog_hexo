---
title: 怎么画好一张架构图？
date: 2020-11-08 15:01:09
categories: 全栈
---

### 用C4模型来思考问题

参考：https://www.infoq.cn/article/C4-architecture-model/

C4 分别表示：

- 系统上下文（Context）
- 容器（Container）
- 组件（Component）
- 代码（Code）

一系列分层的图表，可以用这些图表来描述不同缩放级别的软件架构，每种图表都适用于不同的受众。

#### 系统上下文（Context）

第 1 层是系统上下文图，它显示了你正在构建的软件系统，以及系统与用户及其他软件系统之间的关系。

![01cb5819b9f80163ee0de4285741fa2b](/image/DF39D12F-BAFA-4A27-BA97-72136BE18F93.jpg)

银行的个人客户使用互联网银行系统查看有关银行账户的信息并进行支付。互联网银行系统使用银行现有的大型机银行系统来执行此操作，并使用银行现有的电子邮件系统向客户发送电子邮件。图中的颜色表示哪些软件系统已经存在（灰色）以及待构建的系统（蓝色）。

#### 容器（Container）

第 2 层是一个容器图，将软件系统放大，显示组成该软件系统的容器（应用程序、数据存储、微服务等）。技术决策也是该图的关键部分。以下是互联网银行系统的容器图示例。它显示了互联网银行系统（虚线框）由五个容器组成：服务器端Web 应用程序、客户端单页面应用程序、移动应用程序、服务器端API 应用程序和数据库。

![ff26aa85f64c7605a66798506feaf3ea](/image/13ED31C4-35C6-4F4C-A29B-7D7BCFA455EB.jpg)

Web 应用程序是一个 Java/Spring MVC Web 应用程序，它仅提供静态内容（HTML、CSS 和 JavaScript），包括组成单页应用程序的内容。单页面应用程序是一个运行在客户网络浏览器中的 Angular 应用程序，提供所有的网上银行功能。或者，客户可以使用跨平台 Xamarin 移动应用程序访问互联网银行的部分功能。单页应用程序和移动应用程序都调用 JSON/HTTPS API，这是由服务器端运行的另一个 Java/Spring MVC 应用程序提供的。API 应用程序从数据库中获取用户信息（关系数据库模式）。API 应用程序还使用专有的 XML/HTTPS 接口与现有的大型机银行系统进行通信，以获取有关银行账户或交易的信息。如果需要向客户发送电子邮件，API 应用程序还会调用现有的电子邮件系统。

#### 组件（Component）

第 3 层是组件图，将单个容器放大，以显示其中的组件。这些组件映射到代码库中的真实抽象（例如一组代码）。下面是一个虚拟的网上银行系统的组件图示例，显示了 API 应用程序中的一些组件（而不是全部）。

![7305c5739d2caff49f5452dd040efedd](/image/C0B4BE91-7638-416D-BF4A-2485E5C95F09.jpg)

两个Spring MVC REST 控制器为JSON/HTTPS API 提供访问点，每个控制器随后使用其他组件访问数据库和大型机银行系统中的数据。

#### 代码（Code）

最后，如果你确实想要，或者说有这个必要，可以放大个别组件，以显示该组件的实现方式。以下是一个虚拟的网上银行系统的UML 类图示例（部分），显示了组成MainframeBankingSystemFacade 组件的代码元素（接口和类）。

![c0bba922b79ef285be48c08681047b42](/image/9DACA326-8902-478F-B4CD-F48BDB2420C2.jpg)

它表明该组件由很多类组成，实现细节直接反映了代码。我并不建议创建在这种详细程度的图表，有时候你可以直接从大多数IDE 中获取它们。

### 软件工程中的那些图

需求分析阶段：
- 用例图

概要设计阶段：
- 流程图

详细设计阶段：
- 类图
- 时序图
- 状态图
- 流程图

#### 用例图

用例图是指由参与者、用例，边界以及它们之间的关系构成的用于描述系统功能的视图。

通过绘制用例图，来思考系统的功能，边界情况的处理等。相当于动手前的草稿。

![42fee813cff8af214b38c723e900a2ed](/image/7F76B9BE-15EC-42C1-AD0B-7FD4F5789394.png)

#### 流程图

流程图，用于阐明了业务用例实现的工作流程。主要是为了说明一件闭环的事情。

- 通过画流程图，能够帮助梳理思考的思路，是逻辑更加清晰。
- 流程图还能帮助考虑到逻辑上的遗漏，通过梳理流程上的步骤和关键节点，可以快速发现遗漏之处，以便及时整改。

![09a4da26f2ef55584ba1ec4db1607966](/image/432BB03D-67AC-4711-811E-8D1364BE1400.jpg)

参考：https://zhuanlan.zhihu.com/p/67533900

#### 类图

类图，是显示了模型的静态结构，特别是模型中存在的类、类的内部结构以及它们与其他类的关系等。

类图是代码结构的抽象，通过梳理类图来思考代码依赖关系，能从更客观的角度思考问题。帮助我们把代码结构梳理的更加清晰。

![3e809db39a51941016d58355ce8320e8](/image/BE3EEDCA-AC7E-4E02-8A03-BFA6EB5F7373.png)

参考：https://juejin.im/post/6844903550460362760

#### 时序图

时序图，用于描述对象之间的传递消息的时间顺序。相较于其他UML图，通过描述对象之间发送消息的时间顺序显示多个对象之间的动态协作。

- 时序图强调对象之前的交互关系，同时也强调交互的时间顺序。
- 更能直观的描述并发进程。

![5dad9d3b4ea74bc6ce37e7161e301079](/image/EA60BD99-E28A-4BF1-9C04-498CF2293F8C.png)

参考：http://www.woshipm.com/ucd/607593.html

#### 状态图

状态图是描述一个实体基于事件反应的动态行为，显示了该实体如何根据当前所处的状态对不同的事件做出反应。

**描述关键状态的变化情况时，可以用此图进行说明**。例如单车的订单状态的变更。

![58cdd48a90fb3aa34f53d411617771d0](/image/0ABDCD2B-8193-4758-A6C0-94ECE9BBC5FC.jpg)

参考：https://www.cnblogs.com/ywqu/archive/2009/12/17/1626043.html

### 总结

`架构图 = 架构 + 图`

只有你在脑子里先把架构大体设计，才可以把架构图画清楚。切记本末倒置。

通过C4的思想来进行技术架构的设计，比较容易上手。从大局到细节，都不容易遗漏。是一个较好的架构设计的抽象。

在进行方案设计之初，可以通过用例草图来思考系统的功能点，核心要解决的问题是什么。再结合 C4模型中的 System Context层、Container层 来明确系统的对外交互通讯输出。

等到真正设计系统的实现细节和模块拆分时，则再结合 C4模型中的 Component层、Code层；还有 流程图、类图、时序图 来进行详细模块的设计，以及代码结构设计。
