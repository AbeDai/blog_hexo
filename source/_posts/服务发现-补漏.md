---
title: 服务发现-补漏
date: 2019-07-01 08:50:16
tags: 全栈
---

## 什么是服务发现

在传统的系统部署中，服务运行在一个固定的已知的 IP 和端口上，如果一个服务需要调用另外一个服务，可以通过地址直接调用，但是，在虚拟化或容器话的环境中，服务实例的启动和销毁是很频繁的，服务地址在动态的变化，如果需要将请求发送到动态变化的服务实例上，至少需要两个步骤：

> 1. 服务注册 — 存储服务的主机和端口信息
> 2. 服务发现 — 允许其他用户发现服务注册阶段存储的信息

## 服务发现的优点

服务发现的主要好处是「零配置」：不用使用硬编码的网络地址，只需服务的名字（有时甚至连名字都不用）就能使用服务。在现代的体系架构中，单个服务实例的启动和销毁很常见，所以应该做到：无需了解整个架构的部署拓扑，就能找到这个实例。

## 解决的问题

在一个分布式系统中，服务注册与发现组件主要解决两个问题：服务注册和服务发现。

- 服务注册：服务实例将自身服务信息注册到注册中心。这部分服务信息包括服务所在主机 IP 和提供服务的 Port，以及暴露服务自身状态以及访问协议等信息。
- 服务发现：服务实例请求注册中心获取所依赖服务信息。服务实例通过注册中心，获取到注册到其中的服务实例的信息，通过这些信息去请求它们提供的服务。

除此之外，服务注册与发现需要关注监控服务实例运行状态、负载均衡等问题。

- 监控：微服务应用中，服务处于动态变化的情况，需要一定机制处理无效的服务实例。一般来讲，服务实例与注册中心在注册后通过心跳的方式维系联系，一旦心跳缺少，对应的服务实例会被注册中心剔除。
- 负载均衡：同一服务可能同时存在多个实例，需要正确处理对该服务的负载均衡。

## 客户端发现

在使用客户端发现方式时，客户端通过查询服务注册中心，获取可用的服务的实际网络地址（IP 和端口）。然后通过负载均衡算法来选择一个可用的服务实例，并将请求发送至该服务。
优点：架构简单，扩展灵活，方便实现负载均衡功能。
缺点：强耦合，有一定开发成本。
<img width="900" src="/image/client_discover.jpg">

## 服务端发现

客户端向 load balancer 发送请求。load balancer 查询服务注册中心找到可用的服务，然后转发请求到该服务上。和客户端发现一样，服务都要到注册中心进行服务注册和注销。
优点：服务的发现逻辑对客户端是透明的。
缺点：需要额外部署和维护高可用的负载均衡器。
<img width="900" src="/image/server_discover.jpg">

## 参考

https://www.cnblogs.com/Yemilice/p/10923331.html
